# A4 main-table protocol (Version-C full):
# - eval uses clip_len=16 only (stable comparison)
# - retention moderate + stride_ratio to control clip count without large accuracy loss

_base_: configs/vc_phase3_full_ucf101.yaml

data:
  clip_lens_train: [16]
  clip_lens_eval: [16]
  train_stride_ratio: 0.75
  eval_stride_ratio: 0.75

  window_retention:
    enabled: false

test:
  run_final_test: true

# --- Paper-grade A-main budget (Version-C) ---
training:
  # Version-C trainer uses training.outer_epochs (NOT train.epochs).
  # Must be >= ast.schedule.warmup_epochs(15) to actually enter pruning.
  outer_epochs: 50
  # <=0 means: iterate the whole train dataloader per outer epoch (see trainer patch).
  inner_steps_ast: -1
  # Make StableHW guard decision less noisy. Default was 20 (too jittery).
  stable_hw_eval_max_batches: 200
  # Perf: when lambda_hw_eff==0, skip HW proxy forward (does not change gradients).
  # Keep evaluation (val_acc1) unchanged.
  compute_hw_when_lambda0: false

train:
  # Keep Version-C numerically stable (A1/A2 already use clipping).
  grad_clip_norm: 1.0
  warn_every_steps: 200
  nan_guard_warn_every_steps: 200
