# A2: Token-only (HW off, Window off, Token on)
# Purpose: isolate token sparsity contribution without mixing in window/hardware.
_base_: configs/ast2_ucf101.yaml

training:
  mode: single_device_ast

hw:
  mode: none

stable_hw:
  enabled: false
  force_disable_ok: true

model:
  # enable token pruning path (your code uses this flag for AST pruning hooks)
  use_ast_prune: true
  drop_rate: 0.1
  attn_drop: 0.1
  drop_path_rate: 0.15

data:
  clip_lens_train: [16]
  clip_lens_eval: [16]
  train_stride_ratio: 0.75
  eval_stride_ratio: 0.75
  runtime_tstart_jitter: 8
  frame_sampling_train: "segment_random"
  frame_sampling_eval: "linspace"
  window_retention:
    enabled: false

ast:
  # Paper-style token importance: pixel entropy density (patch-level, fused space+time).
  token_gating_policy: "pixel_entropy"
  # v5.4 strict masking semantics: prevent pos_embed/residual revival and prevent pruned tokens as K/V.
  strict_masking: true
  # Avoid temporal coverage collapse under global top-k.
  topk_mode: "per_frame"  # global | per_frame
  # Deterministic, evenly spaced baseline pattern (used by uniform ablation).
  uniform_mode: "linspace"  # linspace | stride
  gating_fp32: true
  detach_mask: true
  hard_topk: true
  min_keep_ratio: 0.25
  sanitize_nan: true
  token_temperature: 0.5
  schedule:
    enabled: true
    warmup_epochs: 15
    ramp_epochs: 25
    curve: "cosine"
    rho_start: 1.0
    temp_start: 1.0
    lambda_ast_start: 0.0

loss:
  lambda_AST: 0.1

train:
  lr_schedule: "cosine"
  min_lr: 1e-6
  label_smoothing: 0.1
  mixup_alpha: 0.2
  mixup_prob: 1.0
  grad_clip_norm: 1.0
  nan_guard: true
  skip_step_on_nonfinite: true
  ema:
    enabled: true
    decay: 0.9998
    eval: true

test:
  run_final_test: true
